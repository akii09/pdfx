{
  "$schema": "https://pdfx.akashpise.dev/schema/registry-item.json",
  "name": "pdf-image",
  "type": "registry:ui",
  "title": "PdfImage",
  "description": "Image component with 7 display variants, fit modes, and optional captions",
  "files": [
    {
      "path": "components/pdfx/pdf-image/pdfx-pdf-image.tsx",
      "content": "import { Image, Text as PDFText, StyleSheet, View } from '@react-pdf/renderer';\nimport type { Style } from '@react-pdf/types';\nimport { usePdfxTheme, useSafeMemo } from '../lib/pdfx-theme-context';\ntype PdfxTheme = ReturnType<typeof usePdfxTheme>;\n\n// ─── Types ────────────────────────────────────────────────────────────────────\n\n/**\n * Image source accepted by react-pdf's Image component.\n * - string: URL, absolute file path, or base64 data URI (`data:image/png;base64,...`)\n * - object: authenticated URL with custom headers\n */\nexport type PdfImageSrc =\n  | string\n  | { uri: string; method?: string; headers?: Record<string, string>; body?: string };\n\n/**\n * Controls how the image fills its container (mirrors CSS object-fit).\n * - cover: fill, crop excess\n * - contain: fit inside, preserve aspect ratio, may letterbox\n * - fill: stretch to exactly fill (distorts aspect ratio)\n * - none: render at intrinsic size\n */\nexport type PdfImageFit = 'cover' | 'contain' | 'fill' | 'none';\n\n/**\n * Visual layout variant.\n *\n * | Variant      | Width      | Height        | fit     | Notes                    |\n * |-------------|------------|---------------|---------|--------------------------|\n * | default     | prop/auto  | prop/auto     | contain | Standard inline image    |\n * | full-width  | 100%       | prop required | cover   | Banner / hero image      |\n * | thumbnail   | 80pt       | 80pt          | cover   | Small square preview     |\n * | avatar      | 48pt       | 48pt          | cover   | Circle-clipped portrait  |\n * | cover       | 100%       | 160pt         | cover   | Wide cover image         |\n * | bordered    | 100%/prop  | prop          | contain | Framed with border       |\n * | rounded     | prop/200pt | prop          | contain | Rounded corners          |\n */\nexport type PdfImageVariant =\n  | 'default'\n  | 'full-width'\n  | 'thumbnail'\n  | 'avatar'\n  | 'cover'\n  | 'bordered'\n  | 'rounded';\n\nexport interface PdfImageProps {\n  /** Image source: URL, base64 data URI, file path, or authenticated object. */\n  src: PdfImageSrc;\n  /** Display variant controlling size and appearance. @default 'default' */\n  variant?: PdfImageVariant;\n  /** Width in PDF points. Required unless variant provides a default. */\n  width?: number | string;\n  /** Height in PDF points. Required unless variant provides a default. */\n  height?: number | string;\n  /** How the image fills its container. @default variant-dependent */\n  fit?: PdfImageFit;\n  /** Focal point for objectFit crop, e.g. '50% 50%' or 'top left'. @default '50% 50%' */\n  position?: string;\n  /** Optional caption text rendered below the image in muted style. */\n  caption?: string;\n  /**\n   * Aspect ratio helper: if width is provided but height is not,\n   * height = width / aspectRatio. E.g. 16/9 for widescreen images.\n   */\n  aspectRatio?: number;\n  /**\n   * Border radius override in PDF points.\n   * Defaults: avatar = 999 (circle), rounded = 8, others = 0.\n   */\n  borderRadius?: number;\n  /**\n   * Prevent the image (+ optional caption) from being split across page boundaries.\n   * @default true — images should never be clipped at the page edge.\n   */\n  noWrap?: boolean;\n  /** Custom style override applied to the image element. */\n  style?: Style;\n}\n\n// ─── Format validation ────────────────────────────────────────────────────────\n\nconst UNSUPPORTED_FORMATS = ['webp', 'avif', 'heic', 'heif', 'ico'];\n\n/**\n * Detect image format from a string src (URL, data URI, or file path).\n * Returns null if unknown.\n */\nfunction detectFormat(src: PdfImageSrc): string | null {\n  if (typeof src !== 'string') return null;\n  // data URI: data:image/webp;base64,...\n  const dataMatch = src.match(/^data:image\\/([a-zA-Z0-9+.-]+)/);\n  if (dataMatch) return dataMatch[1].toLowerCase();\n  // URL / path: strip query string then get extension\n  const ext = src.split('?')[0].split('.').pop()?.toLowerCase();\n  return ext ?? null;\n}\n\nfunction warnIfUnsupported(src: PdfImageSrc): void {\n  const fmt = detectFormat(src);\n  if (fmt && UNSUPPORTED_FORMATS.includes(fmt)) {\n    console.warn(\n      `[PdfImage] Unsupported format \"${fmt}\" detected. react-pdf supports: JPEG, PNG, GIF (first frame), BMP, SVG. Convert to PNG or JPEG before use (e.g. sharp().toFormat('png')).`\n    );\n  }\n}\n\n// ─── Variant dimension defaults ───────────────────────────────────────────────\n\ninterface VariantDefaults {\n  width?: number | string;\n  height?: number | string;\n  fit: PdfImageFit;\n  borderRadius?: number;\n}\n\nconst VARIANT_DEFAULTS: Record<PdfImageVariant, VariantDefaults> = {\n  default: { fit: 'contain' },\n  'full-width': { width: '100%', fit: 'cover' },\n  thumbnail: { width: 80, height: 80, fit: 'cover' },\n  avatar: { width: 48, height: 48, fit: 'cover', borderRadius: 999 },\n  cover: { width: '100%', height: 160, fit: 'cover' },\n  bordered: { width: '100%', fit: 'contain' },\n  rounded: { width: 200, fit: 'contain', borderRadius: 8 },\n};\n\n// ─── Styles ───────────────────────────────────────────────────────────────────\n\nlet cachedTheme: PdfxTheme | null = null;\nlet cachedStyles: ReturnType<typeof createImageStyles> | null = null;\n\nfunction getStyles(t: PdfxTheme) {\n  if (cachedTheme !== t || !cachedStyles) {\n    cachedStyles = createImageStyles(t);\n    cachedTheme = t;\n  }\n  return cachedStyles;\n}\n\nfunction createImageStyles(t: PdfxTheme) {\n  const { spacing } = t.primitives;\n  return StyleSheet.create({\n    container: {\n      display: 'flex',\n      flexDirection: 'column',\n    },\n    image: {\n      // Base — dimensions are applied dynamically\n    },\n    imageBordered: {\n      borderWidth: 1,\n      borderColor: t.colors.border,\n      borderStyle: 'solid',\n    },\n    caption: {\n      fontFamily: t.typography.body.fontFamily,\n      fontSize: t.primitives.typography.xs,\n      color: t.colors.mutedForeground,\n      marginTop: spacing[1],\n      textAlign: 'center',\n    },\n  });\n}\n\n// ─── PdfImage ─────────────────────────────────────────────────────────────────\n\n/**\n * PdfImage — a validated, theme-aware wrapper around react-pdf's `<Image>`.\n *\n * @example Basic usage\n * ```tsx\n * <PdfImage src=\"https://example.com/photo.jpg\" width={200} height={150} />\n * ```\n *\n * @example Base64 (recommended for reliability)\n * ```tsx\n * <PdfImage src=\"data:image/png;base64,iVBORw0KGgo...\" variant=\"avatar\" />\n * ```\n *\n * @example Full-width banner with caption\n * ```tsx\n * <PdfImage src={bannerUrl} variant=\"cover\" height={120} caption=\"Q1 2025 Team Photo\" />\n * ```\n *\n * @example Aspect ratio helper\n * ```tsx\n * <PdfImage src={chartPng} width={400} aspectRatio={16 / 9} />\n * ```\n *\n * Supported formats: JPEG, PNG, GIF (first frame only), BMP, SVG.\n * Unsupported: WebP, AVIF, HEIC — a console warning is emitted if detected.\n */\nexport function PdfImage({\n  src,\n  variant = 'default',\n  width,\n  height,\n  fit,\n  position = '50% 50%',\n  caption,\n  aspectRatio,\n  borderRadius,\n  noWrap = true,\n  style,\n}: PdfImageProps) {\n  warnIfUnsupported(src);\n\n  const theme = usePdfxTheme();\n  const styles = useSafeMemo(() => getStyles(theme), [theme]);\n  const defaults = VARIANT_DEFAULTS[variant];\n\n  // ── Resolve dimensions ─────────────────────────────────────────────\n  const resolvedWidth = width ?? defaults.width;\n  const resolvedHeight: number | string | undefined = (() => {\n    if (height !== undefined) return height;\n    if (defaults.height !== undefined) return defaults.height;\n    if (aspectRatio !== undefined && typeof resolvedWidth === 'number') {\n      return resolvedWidth / aspectRatio;\n    }\n    return undefined;\n  })();\n\n  const resolvedFit = fit ?? defaults.fit;\n  const resolvedRadius = borderRadius ?? defaults.borderRadius;\n\n  // ── Build image style array ────────────────────────────────────────\n  const imageStyles: Style[] = [styles.image];\n\n  if (resolvedWidth !== undefined) imageStyles.push({ width: resolvedWidth } as Style);\n  if (resolvedHeight !== undefined) imageStyles.push({ height: resolvedHeight } as Style);\n\n  imageStyles.push({\n    objectFit: resolvedFit,\n    objectPosition: position,\n  } as Style);\n\n  if (resolvedRadius !== undefined) {\n    imageStyles.push({ borderRadius: resolvedRadius } as Style);\n  }\n\n  if (variant === 'bordered') {\n    imageStyles.push(styles.imageBordered);\n  }\n\n  if (style) imageStyles.push(style);\n\n  // ── Render ─────────────────────────────────────────────────────────\n  const content = (\n    <View style={styles.container}>\n      <Image src={src} style={imageStyles} />\n      {caption ? <PDFText style={styles.caption}>{caption}</PDFText> : null}\n    </View>\n  );\n\n  return noWrap ? <View wrap={false}>{content}</View> : content;\n}\n",
      "type": "registry:component"
    }
  ],
  "dependencies": [
    "@react-pdf/renderer"
  ],
  "registryDependencies": [
    "theme"
  ]
}